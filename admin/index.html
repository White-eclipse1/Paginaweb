window.CMS_CONFIG = {
      backend: {
        name: "github",
        repo: "White-eclipse1/Paginaweb",
        branch: "main",
        base_url: "https://jolly-sand-06d352c0f.3.azurestaticapps.net",
        auth_endpoint: "api/decap/auth"
      },<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Äî Decap CMS</title>

  <!-- Anti-conflicto CSS (sin importar tu style.css del sitio) -->
  <style>
    html,body{margin:0;height:100%;background:#fff;overflow:auto!important}
    #nc-root,#nc-root>*{min-height:100vh!important;display:block!important;opacity:1!important;visibility:visible!important;position:relative!important;z-index:1!important}
    /* neutraliza estilos heredados solo dentro del admin */
    #nc-root *,#nc-root *::before,#nc-root *::after{all:revert;box-sizing:border-box}
    #nc-root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  </style>

  <!-- IMPORTANT√çSIMO: config inline ANTES del bundle -->
  <script>
    console.log('üîß Configurando Decap CMS...');
    window.CMS_MANUAL_INIT = true;

    window.CMS_CONFIG = {
      backend: {
        name: "github",
        repo: "White-eclipse1/Paginaweb",
        branch: "main",
        // Usar autenticaci√≥n directa de GitHub (OAuth App)
        // Esto requiere que el Client ID sea p√∫blico, pero es el enfoque recomendado
        auth_type: "pkce",
        app_id: "Ov23lINnhitHY6sQueYb"  // Tu GITHUB_CLIENT_ID
      },
      media_folder: "assets/uploads",
      public_folder: "/assets/uploads",
      locale: "es",
      slug: { encoding: "unicode", clean_accents: true },
      collections: [
        {
          name: "updates",
          label: "Noticias / Lanzamientos",
          folder: "_updates",
          create: true,
          slug: "{{slug}}",
          fields: [
            { name: "title", label: "T√≠tulo", widget: "string" },
            { name: "date", label: "Fecha", widget: "datetime" },
            { name: "kind", label: "Tipo", widget: "select", options: ["Noticia","Lanzamiento"], default: "Noticia" },
            { name: "excerpt", label: "Resumen", widget: "text", required: false },
            { name: "cover", label: "Imagen (URL)", widget: "string", required: false },
            { name: "price", label: "Precio (texto)", widget: "string", required: false },
            { name: "body", label: "Contenido", widget: "markdown" }
          ]
        },
        {
          name: "jobs",
          label: "Bolsa de trabajo",
          folder: "_jobs",
          create: true,
          slug: "{{slug}}",
          fields: [
            { name: "title", label: "T√≠tulo del puesto", widget: "string" },
            { name: "date", label: "Fecha", widget: "datetime" },
            { name: "location", label: "Ubicaci√≥n", widget: "string", required: false },
            { name: "contract_type", label: "Tipo de contrato", widget: "select", options: ["Tiempo completo","Medio tiempo","Pr√°cticas","Freelance"] },
            { name: "salary", label: "Salario (texto)", widget: "string", required: false },
            { name: "deadline", label: "Fecha l√≠mite", widget: "datetime", required: false },
            { name: "apply_link", label: "Enlace para aplicar", widget: "string", required: false },
            { name: "apply_email", label: "Correo para aplicar", widget: "string", required: false },
            { name: "excerpt", label: "Descripci√≥n breve", widget: "text", required: false },
            { name: "body", label: "Detalles del puesto", widget: "markdown" }
          ]
        }
      ]
    };
    console.log('‚úÖ Configuraci√≥n lista:', window.CMS_CONFIG);
  </script>
</head>
<body>
  <div id="nc-root"></div>

  <!-- Bundle local (3.5.0) -->
  <script src="./decap-cms.js?v=3.5.0"></script>

  <!-- Init manual: desactiva lectura de config.yml -->
  <script>
    (function boot(){
      console.log('üöÄ Intentando inicializar Decap CMS...');
      
      if (typeof CMS === "undefined") {
        console.log('‚è≥ CMS a√∫n no est√° disponible, reintentando...');
        return setTimeout(boot, 50);
      }
      
      console.log('‚úÖ CMS disponible, inicializando...');
      
      // Verificar si ya hay sesi√≥n guardada ANTES de inicializar
      const savedAuth = localStorage.getItem('decap-cms-user') || localStorage.getItem('netlify-cms-user');
      if (savedAuth) {
        console.log('üîë Sesi√≥n encontrada en localStorage');
        try {
          const authData = JSON.parse(savedAuth);
          console.log('Token presente:', authData.token ? authData.token.substring(0, 20) + '...' : 'No');
          
          // Inyectar el token en el backend de Decap ANTES de inicializar
          if (authData.token && window.CMS_CONFIG) {
            window.CMS_CONFIG.backend.token = authData.token;
            console.log('‚úÖ Token inyectado en configuraci√≥n del backend');
          }
        } catch (e) {
          console.error('Error parseando auth data:', e);
        }
      } else {
        console.log('‚ö†Ô∏è No hay sesi√≥n guardada en localStorage');
      }
      
      // Escuchar eventos de autenticaci√≥n y reenviarlos a Decap
      window.addEventListener('message', function(e) {
        console.log('üì® Mensaje recibido:', e.data);
        
        // Extraer token si viene en formato string
        if (typeof e.data === 'string' && e.data.includes('authorization:github:success')) {
          console.log('‚úÖ Autenticaci√≥n exitosa detectada (formato string)');
          try {
            const match = e.data.match(/authorization:github:success:(.+)/);
            if (match && match[1]) {
              const authData = JSON.parse(match[1]);
              console.log('Token extra√≠do:', authData.token.substring(0, 10) + '...');
              
              // Guardar en localStorage para que Decap lo encuentre
              const authPayload = {
                token: authData.token,
                provider: 'github'
              };
              const payloadString = JSON.stringify(authPayload);
              
              localStorage.setItem('netlify-cms-user', payloadString);
              localStorage.setItem('decap-cms-user', payloadString);
              localStorage.setItem('netlify-cms-auth', payloadString);
              localStorage.setItem('decap-cms-auth', payloadString);
              
              console.log('üíæ Datos guardados en localStorage');
              
              // Recargar la p√°gina para que Decap detecte la sesi√≥n
              setTimeout(() => {
                console.log('üîÑ Recargando p√°gina...');
                window.location.reload();
              }, 500);
            }
          } catch (err) {
            console.error('Error procesando token:', err);
          }
        }
        
        // Tambi√©n manejar formato objeto
        if (typeof e.data === 'object' && e.data.type === 'authorization' && e.data.token) {
          console.log('‚úÖ Autenticaci√≥n exitosa detectada (formato objeto)');
          const authPayload = {
            token: e.data.token,
            provider: e.data.provider || 'github'
          };
          const payloadString = JSON.stringify(authPayload);
          
          localStorage.setItem('netlify-cms-user', payloadString);
          localStorage.setItem('decap-cms-user', payloadString);
          localStorage.setItem('netlify-cms-auth', payloadString);
          localStorage.setItem('decap-cms-auth', payloadString);
          
          console.log('üíæ Datos guardados en localStorage');
          setTimeout(() => {
            console.log('üîÑ Recargando p√°gina...');
            window.location.reload();
          }, 500);
        }
      });
      
      try {
        // Registrar un authenticator personalizado ANTES de inicializar
        const savedAuth = localStorage.getItem('decap-cms-user') || localStorage.getItem('netlify-cms-user');
        
        if (savedAuth) {
          const authData = JSON.parse(savedAuth);
          if (authData.token) {
            console.log('üîê Configurando authenticator con token existente');
            
            // Crear un backend authenticator falso que devuelva el token guardado
            window.CMS_CONFIG.backend.getToken = () => Promise.resolve(authData.token);
          }
        }
        
        CMS.init({
          config: window.CMS_CONFIG,
          load_config_file: false
        });
        console.log('‚úÖ Decap CMS inicializado correctamente');
        
        // Verificar estado despu√©s de inicializar
        setTimeout(() => {
          console.log('üîç Verificando estado de autenticaci√≥n...');
          const authCheck = localStorage.getItem('decap-cms-user') || localStorage.getItem('netlify-cms-user');
          console.log('Auth despu√©s de init:', authCheck ? 'Presente' : 'Ausente');
          
          // Si hay token pero no se carg√≥ el CMS, forzar recarga
          if (authCheck && document.querySelector('[data-slate-editor]') === null) {
            console.log('‚ö†Ô∏è Token presente pero CMS no carg√≥, forzando recarga...');
            setTimeout(() => window.location.reload(), 1000);
          }
        }, 2000);
      } catch (error) {
        console.error('‚ùå Error al inicializar Decap CMS:', error);
      }
    })();
  </script>
</body>
</html>