<!DOCTYPE html>
<html lang="es">
<head><meta charset="UTF-8"><title>Auth OK</title></head>
<body>
<script>
(function(){
  function parse(str){const o={};(str||'').replace(/^[#?]/,'').split('&').forEach(p=>{if(!p)return;const[k,v]=p.split('=');o[decodeURIComponent(k)]=decodeURIComponent(v||'');});return o;}
  const hash=parse(location.hash), q=parse(location.search);
  const token = hash.access_token || hash.token || q.access_token || q.token;
  if(token){
    const payload = JSON.stringify({ token });
    localStorage.setItem('decap-cms-auth', payload);
    localStorage.setItem('netlify-cms-auth', payload);
    try{ if(window.opener) window.opener.postMessage('authorization:github:success','*'); }catch(e){}
    try{ window.close(); }catch(e){}
    location.replace('/admin/');
  }else{
    document.body.innerHTML='<p>No se recibió token de autenticación.</p>';
  }
})();
</script>
</body>
</html>
